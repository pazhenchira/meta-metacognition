# Meta Metacognition Pipeline (Codex CLI)

This repository defines a **hierarchical, LEGO-based, KISS-driven, meta-cognitive R&D pipeline** orchestrated through **Codex CLI**, supporting **both Bash (macOS/Linux)** and **PowerShell (via WSL)**.

You run **one command**, and Codex:

- Performs environment preflight.  
- Extracts application requirements interactively from `app_intent.md` (minimal questions).  
- Discovers a LEGO architecture (single-responsibility blocks).  
- Optionally pauses for LEGO plan / design approval.  
- Spawns one Codex session per LEGO block (LEGO-Orchestrators).  
- For each LEGO, performs design, tests, docs, coding, and validation with GEN+REVIEW.  
- Maintains restartable state and session hygiene.  
- Enforces safety valves and basic red-team evaluation when appropriate.  
- Handles dependencies and external services in durable config files.

You can reuse this repo as a template: for each new app, you only change **`app_intent.md`**.

---

## üìÅ Files YOU Provide (Initial Setup)

In the repo root (e.g., `meta-orchestrator-full/`), you must have:

- `intent.md`  
  ‚Üí Meta-orchestrator intent (how the engine behaves).

- `app_intent.md`  
  ‚Üí Application intent (what app to build). **You edit this per app.**

- `principles.md`  
  ‚Üí Global engineering principles (KISS, LEGO, privacy, testing, red-team, etc.).

- `AGENTS.md`  
  ‚Üí Behavior contract for the Meta-Orchestrator and LEGO-Orchestrators.

- `meta_config.json` (optional; created with defaults if missing)  
  ‚Üí R&D mode and approval flags.

- `README.md`  
  ‚Üí This file.

All other files and folders are generated by Codex.

---

## üöÄ How to Run (Bash + PowerShell)

> ‚ö†Ô∏è Run these from a **Linux/WSL shell** or macOS, not from pure Windows CMD/PowerShell.

### 1Ô∏è‚É£ Initial Meta-Orchestrator Run

From the repo root:

#### Bash

```bash
cd meta-orchestrator-full
codex exec "Act as the meta-orchestrator described in AGENTS.md and run the full pipeline."
```

#### PowerShell (inside WSL or using a Linux shell)

```powershell
cd meta-orchestrator-full
codex exec "Act as the meta-orchestrator described in AGENTS.md and run the full pipeline."
```

You do **not** need to restate the workflow in the command; it is baked into `AGENTS.md`.

### 2Ô∏è‚É£ Resume Later

If Codex stops mid-pipeline or you come back later:

#### Bash

```bash
codex exec resume --last "Continue the meta-orchestrator pipeline."
```

#### PowerShell

```powershell
codex exec resume --last "Continue the meta-orchestrator pipeline."
```

Codex uses state files (e.g., `orchestrator_state.json`, `lego_state_<name>.json`) to continue from where it left off.

---

## üìÅ Files Codex WILL Generate

During execution, Codex will create:

- `requirements.md` ‚Äì application requirements (GEN + REVIEW).  
- `dependencies.md` ‚Äì human-readable dependency summary.  
- `external_services.md` ‚Äì description of external APIs/services.  
- `.env.example` ‚Äì env var names & descriptions (no secrets).  
- Runtime deps file ‚Äì e.g., `requirements.txt` or `package.json`.  
- Dev deps ‚Äì e.g., `deps_dev.txt` or `devDependencies`.  
- `lego_plan.json` ‚Äì LEGO block definitions.  
- `plan.md` ‚Äì pipeline overview.  
- `orchestrator_state.json` ‚Äì global pipeline state.  
- `lego_state_<lego>.json` ‚Äì per-LEGO state.  
- `system_prompt_global.txt` ‚Äì synthesized meta + app-specific system prompt.  
- `src/<lego>.<ext>` ‚Äì implementation per LEGO.  
- `tests/<lego>_tests.<ext>` ‚Äì tests per LEGO.  
- `internal-notes.md` ‚Äì internal technical notes.  
- `review.md` ‚Äì final system-level review.  
- `env_diagnostics.md` ‚Äì *only if* environment/permissions fail.  
- `meta_error.md` ‚Äì *only if* safety valve triggers and pipeline must bail out.

---

## üß† How the Pipeline Works (Conceptual Overview)

1. **Environment Preflight**  
   - Codex ensures it can run commands and write files; if not, it documents the issue and stops.

2. **Interactive Requirements & Dependency Discovery**  
   - Reads `app_intent.md`.  
   - Asks a few targeted questions.  
   - Writes `requirements.md`.  
   - Identifies code packages & external services.  
   - Writes `dependencies.md`, `.env.example`, `external_services.md`, and a runtime deps file.  
   - Does **not** proceed until these are done.

3. **LEGO Discovery (KISS)**  
   - Breaks the app into single-responsibility LEGO blocks.  
   - Writes `lego_plan.json`.

4. **Optional LEGO Plan Approval** (based on `meta_config.json`).

5. **Pipeline Planning & State**  
   - Writes `plan.md` and `orchestrator_state.json` (steps, dependencies, status, failure counts).

6. **LEGO-Orchestrator Sessions**  
   - For each LEGO, a dedicated Codex session does: design, tests, docs, coding, validation (GEN+REVIEW).  
   - Per-LEGO progress is stored in `lego_state_<name>.json`.  
   - Sessions are short and checkpointed.

7. **Safety Valves**  
   - If a step/LEGO keeps failing or no progress is made, Codex writes `meta_error.md` and stops gracefully.

8. **Finalization**  
   - Generates `internal-notes.md`, updates `README.md` if needed, and writes `review.md` summarizing architecture, evaluation, and risks.

---

## üß© Example: Using This for a Stock Analyzer

1. Edit `app_intent.md` to describe your stock analyzer app.
2. Keep `intent.md`, `principles.md`, `AGENTS.md`, and `meta_config.json` as provided (or tweak config).  
3. Run:

   ```bash
   codex exec "Act as the meta-orchestrator described in AGENTS.md and run the full pipeline."
   ```

4. Answer Codex‚Äôs minimal questions.  
5. Let Codex generate requirements, dependencies, LEGO plan, code, tests, docs, and review.  
6. If interrupted, resume with `codex exec resume --last ...`.

---

## üÜò Troubleshooting

- **Codex cannot write files or run commands**  
  - Make sure you are in WSL or a Linux/macOS shell.  
  - Ensure the repo is in a writeable directory (e.g., `~/meta-orchestrator-full/`, not `/mnt/c/...`).  
  - Check `env_diagnostics.md` for details.

- **Pipeline stuck / safety valve triggered**  
  - Inspect `meta_error.md` to see which step/lego failed.  
  - Adjust `app_intent.md`, dependencies, or principles accordingly, then re-run.

- **Too many questions**  
  - Make `app_intent.md` more explicit and keep `"r_and_d_mode": "fast"`.

- **Want deeper exploration**  
  - Set `"r_and_d_mode": "thorough"` in `meta_config.json` for more GEN+REVIEW, detailed eval, and red-team on sensitive legos.

- **Want architecture approval before coding**  
  - Set `"require_lego_plan_approval": true` in `meta_config.json`.

---

## üéâ Summary

This repository is a **universal meta-cognitive R&D engine** for Codex CLI.

- `intent.md` ‚Üí how the meta-engine orchestrates.  
- `app_intent.md` ‚Üí what app to build.  
- `principles.md` & `AGENTS.md` ‚Üí how to think, structure, and validate.  
- `meta_config.json` ‚Üí how thorough and interactive to be.  

With a single Codex command you get:

- Requirements discovery & dependency mapping.  
- LEGO architecture.  
- Per-LEGO design, tests, docs, implementation, and validation.  
- Evaluation & safety valves.  
- Full restartability and extensibility.

Change `app_intent.md` to point this engine at any new application.
